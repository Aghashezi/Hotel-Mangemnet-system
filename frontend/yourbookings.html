<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hotel Booking App</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">

  <style>
    body {
      background-color: #f8f9fa;
      font-family: Arial, sans-serif;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 40px 20px;
      animation: fade-in 1s ease-in-out;
    }

    @keyframes fade-in {
      0% {
        opacity: 0;
        transform: translateY(-20px);
      }
      100% {
        opacity: 1;
        transform: translateY(0);
      }
    }

    h1 {
      text-align: center;
      margin-bottom: 30px;
      color: #007bff;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      animation: slide-down 1s ease-in-out;
    }

    @keyframes slide-down {
      0% {
        opacity: 0;
        transform: translateY(-20px);
      }
      100% {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .form-group {
      margin-bottom: 20px;
      animation: slide-up 1s ease-in-out;
    }

    @keyframes slide-up {
      0% {
        opacity: 0;
        transform: translateY(20px);
      }
      100% {
        opacity: 1;
        transform: translateY(0);
      }
    }

    table {
      background-color: #fff;
      border-radius: 4px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
      animation: fade-in 1s ease-in-out;
    }

    th {
      background-color: #f8f9fa;
      font-weight: bold;
    }

    .btn-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 30px;
      animation: slide-up 1s ease-in-out;
    }

    .btn-primary {
      background-color: #007bff;
      border-color: #007bff;
    }

    .btn-primary:hover {
      background-color: #0069d9;
      border-color: #0062cc;
    }

    .btn-danger {
      background-color: #dc3545;
      border-color: #dc3545;
    }

    .btn-danger:hover {
      background-color: #c82333;
      border-color: #bd2130;
    }

    .booking-info {
      text-align: center;
      color: #888;
      margin-top: 30px;
      font-size: 18px;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
      animation: fade-in 1s ease-in-out;
    }

    .no-bookings {
      text-align: center;
      color: #dc3545;
      font-weight: bold;
      margin-top: 30px;
      font-size: 18px;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
      animation: fade-in 1s ease-in-out;
    }

    .delete-container {
      text-align: center;
      margin-top: 30px;
      animation: fade-in 1s ease-in-out;
    }

    .delete-container p {
      color: #888;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>Hotel Booking App</h1>
    <form id="emailForm">
      <div class="form-group">
        <label for="emailInput">Email</label>
        <input type="email" class="form-control" id="emailInput" name="email" required>
      </div>
      <button type="submit" class="btn btn-primary">Retrieve Bookings</button>
    </form>

    <table class="table mt-4">
      <thead>
        <tr>
          <th>Name</th>
          <th>Email</th>
          <th>Phone Number</th>
          <th>Check-in Date</th>
          <th>Check-out Date</th>
          <th>Guests</th>
          <th>Room Type</th>
          <th>Special Requests</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="bookingTableBody">

      </tbody>
    </table>

    <div class="row mt-4">
      <div class="col-md-6">
        <a href="./update.html" class="btn btn-primary btn-lg">Update</a>
      </div>
      <div class="col-md-6" id="deleteButtonContainer" style="display: none;">
        <div class="delete-container">
          <p>To delete a booking, click the Delete button below.</p>
          <button id="deleteButton" class="btn btn-danger btn-lg">Delete</button>
        </div>
      </div>
    </div>

    <p class="booking-info">Retrieve your bookings by entering your email above.</p>

    <script>

      const emailForm = document.getElementById('emailForm');
      const emailInput = document.getElementById('emailInput');
      const tableBody = document.getElementById('bookingTableBody');
      const deleteButtonContainer = document.getElementById('deleteButtonContainer');
      const deleteButton = document.getElementById('deleteButton');

      emailForm.addEventListener('submit', function (event) {
        event.preventDefault(); // Prevent the form from submitting normally

        const email = emailInput.value;

        // Clear table body before populating with new bookings
        tableBody.innerHTML = '';

        fetch(`http://localhost:3000/Hotel/bookings/${email}`)
          .then(response => response.json())
          .then(data => {
            if (data.error) {
              const row = tableBody.insertRow();
              const cell = row.insertCell();
              cell.colSpan = 9;
              cell.textContent = data.error;
              deleteButtonContainer.style.display = 'none';
            } else if (data.length === 0) {
              const row = tableBody.insertRow();
              const cell = row.insertCell();
              cell.colSpan = 9;
              cell.textContent = 'No bookings found for the email.';
              deleteButtonContainer.style.display = 'none';
            } else {
              data.forEach(booking => {
                const row = tableBody.insertRow();
                row.insertCell().textContent = booking.name;
                row.insertCell().textContent = booking.email;
                row.insertCell().textContent = booking.phoneNumber;
                row.insertCell().textContent = booking.checkInDate;
                row.insertCell().textContent = booking.checkOutDate;
                row.insertCell().textContent = booking.guests;
                row.insertCell().textContent = booking.roomType;
                row.insertCell().textContent = booking.specialRequests;

                deleteButtonContainer.style.display = 'block';
              });
            }
          })
          .catch(error => {
            console.log('Error retrieving bookings:', error);
            alert('An error occurred while retrieving the bookings.');
          });
      });

      deleteButton.addEventListener('click', function () {
        if (confirm('Are you sure you want to delete this booking?')) {
          const email = emailInput.value;
          deleteBooking(email);
        }
      });

      function deleteBooking(email) {
        fetch(`http://localhost:3000/Hotel/bookings/${email}`, {
          method: 'DELETE'
        })
          .then(response => {
            if (!response.ok) {
              throw new Error('Error deleting booking');
            }
            alert('Booking deleted successfully.');
            emailForm.reset(); 
            tableBody.innerHTML = ''; 
            deleteButtonContainer.style.display = 'none'; 
          })
          .catch(error => {
            console.log('Error deleting booking:', error);
            alert('An error occurred while deleting the booking.');
          });
      }
    </script>
  </div>


  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
</body>

</html>
